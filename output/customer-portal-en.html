<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chargeback Alert Management Platform - Merchant Portal</title>
  <style>
    /* CSS变量定义 */
    :root {
      /* 主色调 - 橙色系 */
      --primary-orange: #FF6B35;
      --primary-orange-light: #FF8659;
      --primary-orange-dark: #E55A2B;
      --primary-orange-pale: #FFF4F0;

      /* 辅助色彩 */
      --secondary-blue: #2E86C1;
      --secondary-green: #28B463;
      --secondary-red: #E74C3C;
      --secondary-yellow: #F39C12;

      /* 中性色彩 */
      --gray-50: #F8FAFC;
      --gray-100: #F1F5F9;
      --gray-200: #E2E8F0;
      --gray-300: #CBD5E1;
      --gray-400: #94A3B8;
      --gray-500: #64748B;
      --gray-600: #475569;
      --gray-700: #334155;
      --gray-800: #1E293B;
      --gray-900: #0F172A;

      /* 背景色彩 */
      --bg-primary: #FFFFFF;
      --bg-secondary: #F8FAFC;
      --bg-tertiary: #F1F5F9;

      /* 状态色彩 */
      --success: #22C55E;
      --success-light: #DCFCE7;
      --warning: #F59E0B;
      --warning-light: #FEF3C7;
      --danger: #EF4444;
      --danger-light: #FEE2E2;
      --info: #3B82F6;
      --info-light: #DBEAFE;

      /* 风险等级色彩 */
      --risk-high: #DC2626;
      --risk-medium: #F59E0B;
      --risk-low: #16A34A;

      /* 字体规范 */
      --font-family-base: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      --font-family-number: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;

      /* 字体大小 */
      --font-size-h1: 32px;
      --font-size-h2: 24px;
      --font-size-h3: 20px;
      --font-size-h4: 18px;
      --font-size-h5: 16px;
      --font-size-base: 14px;
      --font-size-large: 16px;
      --font-size-small: 12px;
      --font-size-xs: 10px;

      /* 间距系统 */
      --spacing-xs: 4px;
      --spacing-sm: 8px;
      --spacing-md: 16px;
      --spacing-lg: 24px;
      --spacing-xl: 32px;
      --spacing-2xl: 48px;

      /* 圆角与阴影 */
      --border-radius-sm: 4px;
      --border-radius-md: 6px;
      --border-radius-lg: 8px;
      --border-radius-xl: 12px;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    }

    /* 全局样式重置 */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-family-base);
      font-size: var(--font-size-base);
      line-height: 1.5;
      color: var(--gray-700);
      background: var(--bg-secondary);
    }

    /* 通用组件样式 */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-sm);
      padding: var(--spacing-sm) var(--spacing-md);
      border-radius: var(--border-radius-md);
      font-size: var(--font-size-base);
      font-weight: 500;
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
    }

    .btn-primary {
      background: var(--primary-orange);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-orange-dark);
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .btn-secondary {
      background: var(--gray-100);
      color: var(--gray-600);
      border: 1px solid var(--gray-200);
    }

    .btn-text {
      background: transparent;
      color: var(--primary-orange);
      padding: var(--spacing-xs) var(--spacing-sm);
    }

    .btn-block {
      width: 100%;
      justify-content: center;
    }

    .card {
      background: var(--bg-primary);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--gray-200);
      overflow: hidden;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--spacing-lg);
      border-bottom: 1px solid var(--gray-200);
      background: var(--bg-secondary);
    }

    .card-title {
      margin: 0;
      font-size: var(--font-size-h4);
      font-weight: 600;
      color: var(--gray-700);
    }

    .card-body {
      padding: var(--spacing-lg);
    }

    .form-field {
      margin-bottom: var(--spacing-md);
    }

    .form-label {
      display: block;
      margin-bottom: var(--spacing-sm);
      font-size: var(--font-size-base);
      font-weight: 500;
      color: var(--gray-700);
    }

    .form-input {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--gray-200);
      border-radius: var(--border-radius-md);
      font-size: var(--font-size-base);
      transition: border-color 0.2s ease;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--primary-orange);
      box-shadow: 0 0 0 3px var(--primary-orange-pale);
    }

    .form-select {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid var(--gray-200);
      border-radius: var(--border-radius-md);
      font-size: var(--font-size-base);
      background: white;
    }

    .form-textarea {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--gray-200);
      border-radius: var(--border-radius-md);
      font-size: var(--font-size-base);
      font-family: inherit;
      resize: vertical;
      min-height: 80px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: var(--font-size-small);
      font-weight: 500;
      line-height: 1;
    }

    .badge-success {
      background: var(--success-light);
      color: var(--success);
    }

    .badge-warning {
      background: var(--warning-light);
      color: var(--warning);
    }

    .badge-danger {
      background: var(--danger-light);
      color: var(--danger);
    }

    .badge-info {
      background: var(--info-light);
      color: var(--info);
    }

    .badge-ethoca {
      background: var(--info-light);
      color: var(--info);
    }

    .badge-rdr {
      background: var(--success-light);
      color: var(--success);
    }

    .badge-secondary {
      background: var(--gray-200);
      color: var(--gray-600);
    }

    .risk-badge {
      padding: 6px 12px;
      border-radius: var(--border-radius-md);
      font-weight: 600;
      font-size: var(--font-size-small);
      color: white;
    }

    .risk-high { background: var(--risk-high); }
    .risk-medium { background: var(--risk-medium); }
    .risk-low { background: var(--risk-low); }

    /* 页面容器 */
    .page {
      display: none;
      min-height: 100vh;
    }

    .page.active {
      display: block;
    }

    /* 登录页面样式 */
    .login-page {
      display: grid;
      grid-template-columns: 1fr 1fr;
      min-height: 100vh;
      background: linear-gradient(135deg, var(--primary-orange-pale) 0%, var(--bg-primary) 100%);
    }

    .login-container {
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: var(--spacing-2xl);
      max-width: 500px;
      margin: 0 auto;
    }

    .login-header {
      text-align: center;
      margin-bottom: var(--spacing-2xl);
    }

    .logo {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-md);
    }

    .logo-icon {
      width: 48px;
      height: 48px;
      background: var(--primary-orange);
      border-radius: var(--border-radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
      font-weight: bold;
    }

    .login-title {
      color: var(--gray-700);
      font-size: var(--font-size-h2);
      margin: 0;
    }

    .login-subtitle {
      color: var(--gray-500);
      margin-top: var(--spacing-sm);
    }

    .login-form {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-lg);
    }

    .form-options {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .form-footer {
      text-align: center;
      color: var(--gray-500);
    }

    .login-illustration {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--spacing-2xl);
      background: var(--primary-orange-pale);
      position: relative;
    }

    .illustration-placeholder {
      width: 300px;
      height: 300px;
      background: var(--primary-orange);
      border-radius: var(--border-radius-xl);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: var(--font-size-h3);
      text-align: center;
    }

    /* 主应用布局 */
    .app-layout {
      display: grid;
      grid-template-areas: 
        "header header"
        "sidebar main";
      grid-template-columns: 260px 1fr;
      grid-template-rows: 64px 1fr;
      height: 100vh;
      background: var(--bg-secondary);
    }

    .app-header {
      grid-area: header;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 var(--spacing-lg);
      background: var(--bg-primary);
      border-bottom: 1px solid var(--gray-200);
      box-shadow: var(--shadow-sm);
    }

    .header-left .logo {
      justify-content: flex-start;
    }

    .logo-text {
      font-size: var(--font-size-large);
      font-weight: 600;
      color: var(--gray-700);
    }

    .user-menu {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      position: relative;
      cursor: pointer;
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--primary-orange);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
    }

    .app-sidebar {
      grid-area: sidebar;
      background: var(--bg-primary);
      border-right: 1px solid var(--gray-200);
      padding: var(--spacing-lg) 0;
    }

    .sidebar-nav {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
      padding: 0 var(--spacing-md);
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      padding: 12px var(--spacing-md);
      border-radius: var(--border-radius-md);
      color: var(--gray-600);
      text-decoration: none;
      transition: all 0.2s ease;
      cursor: pointer;
    }

    .nav-item:hover {
      background: var(--gray-100);
      color: var(--gray-700);
    }

    .nav-item.active {
      background: var(--primary-orange-pale);
      color: var(--primary-orange);
    }

    .nav-icon {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .app-main {
      grid-area: main;
      padding: var(--spacing-lg);
      overflow-y: auto;
    }

    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-xl);
    }

    .page-title {
      margin: 0;
      font-size: var(--font-size-h2);
      font-weight: 600;
      color: var(--gray-700);
    }

    /* 卡片管理样式 */
    .card-form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: var(--spacing-lg);
    }

    .card-list {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-sm);
    }

    .card-item {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1fr 120px;
      gap: var(--spacing-md);
      padding: var(--spacing-md);
      border-radius: var(--border-radius-md);
      border: 1px solid var(--gray-200);
      align-items: center;
      background: var(--bg-primary);
    }

    .card-item:hover {
      box-shadow: var(--shadow-md);
    }

    /* 弹窗样式 */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    .modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: var(--bg-primary);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-xl);
      max-width: 600px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        transform: translateY(-50px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    /* 预警列表样式 */
    .filters-bar {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      gap: var(--spacing-lg);
      padding: var(--spacing-lg);
      background: var(--bg-primary);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--gray-200);
      margin-bottom: var(--spacing-lg);
    }

    .filters-left {
      display: flex;
      gap: var(--spacing-lg);
      flex-wrap: wrap;
    }

    .filters-right {
      display: flex;
      gap: var(--spacing-sm);
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
      min-width: 120px;
    }

    .filter-group label {
      font-size: var(--font-size-small);
      font-weight: 500;
      color: var(--gray-600);
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
    }

    .data-table th {
      padding: var(--spacing-md);
      text-align: left;
      font-weight: 600;
      color: var(--gray-700);
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--gray-200);
    }

    .data-table td {
      padding: var(--spacing-md);
      border-bottom: 1px solid var(--gray-200);
    }

    .table-row:hover {
      background: var(--bg-secondary);
    }

    /* 预警详情样式 */
    .breadcrumb {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      font-size: var(--font-size-base);
      color: var(--gray-500);
      margin-bottom: var(--spacing-lg);
    }

    .breadcrumb a {
      color: var(--primary-orange);
      text-decoration: none;
      cursor: pointer;
    }

    .breadcrumb-separator {
      color: var(--gray-300);
    }

    .breadcrumb-current {
      color: var(--gray-700);
      font-weight: 500;
    }

    .alert-summary {
      background: var(--bg-primary);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--gray-200);
      padding: var(--spacing-xl);
      margin-bottom: var(--spacing-lg);
    }

    .alert-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: var(--spacing-lg);
    }

    .alert-title h1 {
      margin: 0;
      font-size: var(--font-size-h2);
      color: var(--gray-700);
    }

    .alert-meta {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--spacing-lg);
    }

    .meta-item {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
    }

    .meta-label {
      font-size: var(--font-size-small);
      color: var(--gray-400);
      font-weight: 500;
    }

    .meta-value {
      font-size: var(--font-size-base);
      color: var(--gray-700);
      font-weight: 600;
    }

    /* 响应式设计 */
    @media (max-width: 768px) {
      .login-page {
        grid-template-columns: 1fr;
      }
      
      .login-illustration {
        display: none;
      }

      .app-layout {
        grid-template-areas: 
          "header"
          "main";
        grid-template-columns: 1fr;
      }
      
      .app-sidebar {
        display: none;
      }

      .filters-bar {
        flex-direction: column;
        align-items: stretch;
      }
      
      .filters-left {
        flex-direction: column;
        gap: var(--spacing-md);
      }
    }

    /* 动画效果 */
    .fade-in {
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* 工具类 */
    .hidden {
      display: none !important;
    }

    .text-center {
      text-align: center;
    }

    .text-right {
      text-align: right;
    }

    /* 用户下拉菜单样式 */
    .user-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      min-width: 180px;
      background: var(--bg-primary);
      border: 1px solid var(--gray-200);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-lg);
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.2s ease;
      margin-top: 8px;
    }

    .user-dropdown.active {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .dropdown-item {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      padding: 12px 16px;
      color: var(--gray-700);
      cursor: pointer;
      transition: all 0.2s ease;
      border-radius: var(--border-radius-md);
      margin: 4px;
    }

    .dropdown-item:hover {
      background: var(--gray-100);
      color: var(--gray-800);
    }

    .dropdown-icon {
      font-size: 16px;
    }

    .dropdown-divider {
      height: 1px;
      background: var(--gray-200);
      margin: 4px 0;
    }

    /* 修改密码页面样式 */
    .change-password-container {
      max-width: 600px;
      margin: 0 auto;
    }

    .password-form {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-lg);
    }

    .form-error {
      color: var(--danger);
      font-size: var(--font-size-small);
      margin-top: var(--spacing-xs);
      display: none;
    }

    .form-success {
      color: var(--success);
      font-size: var(--font-size-small);
      margin-top: var(--spacing-xs);
      display: none;
    }

    .form-input.error {
      border-color: var(--danger);
      box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
    }

    .form-input.success {
      border-color: var(--success);
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
    }

    .password-requirements {
      background: var(--info-light);
      padding: var(--spacing-md);
      border-radius: var(--border-radius-md);
      margin-top: var(--spacing-sm);
    }

    .requirement-item {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      font-size: var(--font-size-small);
      color: var(--gray-600);
      margin-bottom: var(--spacing-xs);
    }

    .requirement-item:last-child {
      margin-bottom: 0;
    }

    .requirement-icon {
      font-size: 12px;
    }

    .requirement-item.valid {
      color: var(--success);
    }

    .requirement-item.invalid {
      color: var(--danger);
    }
  </style>
</head>
<body>
  <!-- 登录页面 -->
  <div id="login-page" class="page active">
    <div class="login-page">
      <div class="login-container">
        <div class="login-header">
          <div class="logo">
            <div class="logo-icon">CB</div>
          </div>
          <h1 class="login-title">Merchant Portal</h1>
          <p class="login-subtitle">Chargeback Alert Management Platform</p>
        </div>
        
        <form class="login-form" onsubmit="handleLogin(event)">
          <div class="form-field">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" placeholder="Enter your email address" required>
          </div>
          
          <div class="form-field">
            <label class="form-label">Password</label>
            <input type="password" class="form-input" placeholder="Enter your password" required>
          </div>
          
          <div class="form-options">
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
              <input type="checkbox">
              <span>Remember me</span>
            </label>
          </div>
          
          <button type="submit" class="btn btn-primary btn-block">Sign In</button>
        </form>
      </div>
      
      <div class="login-illustration">
        <div class="illustration-placeholder">
          Professional<br>Chargeback<br>Alert Service
        </div>
      </div>
    </div>
  </div>

  <!-- 主应用页面 -->
  <div id="app-page" class="page">
    <div class="app-layout">
      <!-- 顶部导航栏 -->
      <header class="app-header">
        <div class="header-left">
          <div class="logo">
            <div class="logo-icon" style="width: 32px; height: 32px; font-size: 16px;">CB</div>
            <span class="logo-text">Chargeback Alert Management</span>
          </div>
        </div>
        <div class="header-right">
          <div class="user-menu" onclick="toggleUserDropdown()">
            <div class="user-avatar">J</div>
            <span style="color: var(--gray-700); font-weight: 500;">John (ABC Merchant)</span>
            <button class="btn btn-text">
              <span style="margin-left: 8px;">▼</span>
            </button>
            <!-- 用户下拉菜单 -->
            <div class="user-dropdown" id="user-dropdown">
              <div class="dropdown-item" onclick="event.stopPropagation(); showPage('change-password'); toggleUserDropdown();">
                <span class="dropdown-icon">🔒</span>
                <span>Change Password</span>
              </div>
              <div class="dropdown-divider"></div>
              <div class="dropdown-item" onclick="event.stopPropagation(); handleLogout();">
                <span class="dropdown-icon">🚪</span>
                <span>Sign Out</span>
              </div>
            </div>
          </div>
        </div>
      </header>

      <!-- 侧边导航栏 -->
      <aside class="app-sidebar">
        <nav class="sidebar-nav">
          <a href="#" class="nav-item active" onclick="showPage('descriptors')">
            <div class="nav-icon">🏷️</div>
            <span>Descriptor Management</span>
          </a>
          <a href="#" class="nav-item" onclick="showPage('alerts')">
            <div class="nav-icon">⚠️</div>
            <span>Alert Center</span>
          </a>
        </nav>
      </aside>

      <!-- 主内容区域 -->
      <main class="app-main">
        <!-- Descriptor管理页面 -->
        <div id="descriptors-content" class="content-page active">
          <div class="page-header">
            <h1 class="page-title">Descriptor Management</h1>
            <div class="page-actions">
              <button class="btn btn-primary" onclick="showAddDescriptorModal()">Add Descriptor</button>
            </div>
          </div>
          
          <!-- 筛选栏 -->
          <div class="filters-bar">
            <div class="filters-left">
              <div class="filter-group">
                <label>Alert Type</label>
                <select class="form-select" id="filter-alert-type">
                  <option value="">All Types</option>
                  <option value="ETHOCA">ETHOCA</option>
                  <option value="RDR">RDR</option>
                </select>
              </div>
              
              <div class="filter-group">
                <label>Descriptor</label>
                <input type="text" class="form-input" placeholder="Enter descriptor" id="filter-descriptor">
              </div>
              
              <div class="filter-group">
                <label>Creation Date Range</label>
                <div style="display: flex; gap: var(--spacing-sm);">
                  <input type="date" class="form-input" id="filter-date-start" style="width: 140px;">
                  <span style="line-height: 2.5; color: var(--gray-500);">to</span>
                  <input type="date" class="form-input" id="filter-date-end" style="width: 140px;">
                </div>
              </div>
              
              <div class="filter-group">
                <label>Status</label>
                <select class="form-select" id="filter-status">
                  <option value="">All Status</option>
                  <option value="Pending">Pending</option>
                  <option value="Registered">Registered</option>
                  <option value="Closed">Closed</option>
                </select>
              </div>
            </div>
            
            <div class="filters-right">
              <button class="btn btn-secondary" onclick="resetFilters()">Reset</button>
              <button class="btn btn-primary" onclick="applyFilters()">Search</button>
            </div>
          </div>
          
          <!-- Descriptor列表 -->
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Authorized Descriptors</h3>
            </div>
            <div class="card-body">
              <div style="overflow-x: auto;">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>Alert Type</th>
                      <th>Descriptor</th>
                      <th>BIN</th>
                      <th>CAID</th>
                      <th>Status</th>
                      <th>Created Time</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="descriptors-table-body">
                    <!-- 动态生成数据 -->
                  </tbody>
                </table>
              </div>
              
              <!-- 分页器 -->
              <div style="padding: var(--spacing-lg); border-top: 1px solid var(--gray-200); background: var(--bg-secondary);">
                <div style="display: flex; align-items: center; justify-content: space-between;">
                  <div style="color: var(--gray-600);" id="pagination-info">
                    Showing 1-10 of 18 records
                  </div>
                  <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                    <button class="btn btn-secondary" id="prev-btn" onclick="changePage(-1)">Previous</button>
                    <div style="display: flex; gap: var(--spacing-xs);" id="page-numbers">
                      <!-- 动态生成页码 -->
                    </div>
                    <button class="btn btn-secondary" id="next-btn" onclick="changePage(1)">Next</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 预警中心页面 -->
        <div id="alerts-content" class="content-page">
          <div class="page-header">
            <h1 class="page-title">Alert Center</h1>
            <div class="page-actions">
              <button class="btn btn-primary">Export Data</button>
            </div>
          </div>
          
          <!-- 筛选栏 -->
          <div class="filters-bar">
            <div class="filters-left">
              <div class="filter-group">
                <label>Dispute Type</label>
                <select class="form-select" id="filter-dispute-type">
                  <option value="">All Types</option>
                  <option value="fraud">fraud</option>
                  <option value="dispute">dispute</option>
                </select>
              </div>
              
              <div class="filter-group">
                <label>Processing Status</label>
                <select class="form-select" id="filter-process-status">
                  <option value="">All Status</option>
                  <option value="Pending">Pending</option>
                  <option value="Processing">Processing</option>
                  <option value="Processed">Processed</option>
                  <option value="Rejected">Rejected</option>
                </select>
              </div>
              
              <div class="filter-group">
                <label>Receive Time Range</label>
                <div style="display: flex; gap: var(--spacing-sm);">
                  <input type="date" class="form-input" id="filter-receive-start" style="width: 140px;">
                  <span style="line-height: 2.5; color: var(--gray-500);">to</span>
                  <input type="date" class="form-input" id="filter-receive-end" style="width: 140px;">
                </div>
              </div>
            </div>
            
            <div class="filters-right">
              <button class="btn btn-secondary" onclick="resetAlertFilters()">Reset</button>
              <button class="btn btn-primary" onclick="applyAlertFilters()">Search</button>
            </div>
          </div>
          
          <!-- 预警列表 -->
          <div class="card">
            <div style="overflow-x: auto;">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Receive Time</th>
                    <th>Dispute Type</th>
                    <th>Alert Source</th>
                    <th>Transaction Amount</th>
                    <th>Description</th>
                    <th>Processing Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="alerts-table-body">
                  <!-- 动态生成数据 -->
                </tbody>
              </table>
            </div>
            
            <!-- 分页器 -->
            <div style="padding: var(--spacing-lg); border-top: 1px solid var(--gray-200); background: var(--bg-secondary);">
              <div style="display: flex; align-items: center; justify-content: space-between;">
                <div style="color: var(--gray-600);" id="alerts-pagination-info">
                  Showing 1-10 of 20 records
                </div>
                <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                  <button class="btn btn-secondary" id="alerts-prev-btn" onclick="changeAlertsPage(-1)">Previous</button>
                  <div style="display: flex; gap: var(--spacing-xs);" id="alerts-page-numbers">
                    <!-- 动态生成页码 -->
                  </div>
                  <button class="btn btn-secondary" id="alerts-next-btn" onclick="changeAlertsPage(1)">Next</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 预警详情页面 -->
        <div id="alert-detail-content" class="content-page">
          <div class="breadcrumb">
            <a href="#" onclick="showPage('alerts')">Alert Center</a>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-current">Alert Details</span>
          </div>
          
          <!-- 基础信息 -->
          <div class="alert-summary">
            <div class="alert-header">
              <div class="alert-title">
                <h1>Basic Information</h1>
                <span style="font-family: var(--font-family-number); font-size: var(--font-size-large); color: var(--gray-500); font-weight: 500;" id="detail-alert-id">CHB_20241201_001</span>
              </div>
              <div style="display: flex; gap: var(--spacing-sm); align-items: center;">
                <span class="badge" id="detail-dispute-type">Unauthorized Transaction</span>
                <span class="badge badge-warning" id="detail-status">Pending</span>
              </div>
            </div>
            
            <div class="alert-meta">
              <div class="meta-item">
                <span class="meta-label">Receive Time</span>
                <span class="meta-value" id="detail-receive-time">2024-12-01 14:30:25</span>
              </div>
              <div class="meta-item">
                <span class="meta-label">Alert Time</span>
                <span class="meta-value" id="detail-alert-time">2024-12-01 14:28:10</span>
              </div>
              <div class="meta-item">
                <span class="meta-label">Alert ID</span>
                <span class="meta-value" id="detail-alert-id-copy">CHB_20241201_001</span>
              </div>
              <div class="meta-item">
                <span class="meta-label">Dispute Type</span>
                <span class="meta-value" id="detail-dispute-type-copy">Unauthorized Transaction</span>
              </div>
              <div class="meta-item">
                <span class="meta-label">Alert Source</span>
                <span class="meta-value" id="detail-source">Visa Card</span>
              </div>
              <div class="meta-item">
                <span class="meta-label">Transaction Amount</span>
                <span class="meta-value" id="detail-amount">$1,250.00 USD</span>
              </div>
              <div class="meta-item">
                <span class="meta-label">Description Summary</span>
                <span class="meta-value" id="detail-description">Customer claims not to have made this transaction</span>
              </div>
            </div>
          </div>
          
          <!-- 更多信息 -->
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">More Information</h3>
            </div>
            <div class="card-body">
              <!-- V卡信息 -->
              <div id="visa-details" style="display: none;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--spacing-lg);">
                  <div class="meta-item">
                    <span class="meta-label">Card BIN</span>
                    <span class="meta-value" id="visa-bin">418756</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-label">CAID</span>
                    <span class="meta-value" id="visa-caid">CA001234</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-label">Card Number</span>
                    <span class="meta-value" id="visa-card-number">****1234</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-label">Acquirer Bank BIN</span>
                    <span class="meta-value" id="visa-acquirer-bin">123456</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-label">Acquirer Reference Number</span>
                    <span class="meta-value" id="visa-acquirer-ref">REF123456789</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-label">Authorization Code</span>
                    <span class="meta-value" id="visa-auth-code">AUTH123</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-label">Chargeback Reason Code</span>
                    <span class="meta-value" id="visa-reason-code">10.4</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-label">Description Contact</span>
                    <span class="meta-value" id="visa-contact">John Smith</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-label">Dispute Amount</span>
                    <span class="meta-value" id="visa-dispute-amount">$1,250.00</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-label">Merchant Category Code</span>
                    <span class="meta-value" id="visa-mcc">5411</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-label">Rule Name</span>
                    <span class="meta-value" id="visa-rule-name">Unauthorized Transaction Rule</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-label">Rule Type</span>
                    <span class="meta-value" id="visa-rule-type">Fraud Prevention</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-label">Transaction Date</span>
                    <span class="meta-value" id="visa-transaction-date">2024-11-30</span>
                  </div>
                </div>
              </div>
              
              <!-- M卡信息 -->
              <div id="mastercard-details" style="display: none;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--spacing-lg);">
                  <div class="meta-item">
                    <span class="meta-label">ARN</span>
                    <span class="meta-value" id="mc-arn">12345678901234567890123</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-label">Authorization Code</span>
                    <span class="meta-value" id="mc-auth-code">AUTH456</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-label">Card BIN</span>
                    <span class="meta-value" id="mc-bin">512345</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-label">Card Number</span>
                    <span class="meta-value" id="mc-card-number">****5678</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-label">Chargeback Reason Code</span>
                    <span class="meta-value" id="mc-reason-code">4837</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-label">Dispute Amount</span>
                    <span class="meta-value" id="mc-dispute-amount">$850.00</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-label">Initiated By</span>
                    <span class="meta-value" id="mc-initiated-by">Cardholder</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-label">Issuer Name</span>
                    <span class="meta-value" id="mc-issuer-name">China Merchants Bank</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-label">3D Liability Shift</span>
                    <span class="meta-value" id="mc-3d-liability">No</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-label">Merchant Category Code</span>
                    <span class="meta-value" id="mc-mcc">5999</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-label">Transaction ID</span>
                    <span class="meta-value" id="mc-transaction-id">TXN_987654322</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-label">Transaction Time</span>
                    <span class="meta-value" id="mc-transaction-time">2024-11-30 15:30:20</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-label">Transaction Type</span>
                    <span class="meta-value" id="mc-transaction-type">Online Payment</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- 反馈模块（仅M卡显示） -->
          <div class="card" id="feedback-section" style="display: none;">
            <div class="card-header">
              <h3 class="card-title">Feedback</h3>
            </div>
            <div class="card-body">
              <form onsubmit="handleAlertFeedback(event)" id="feedback-form">
                <div class="form-field">
                  <label class="form-label">Feedback Result *</label>
                  <select class="form-select" name="feedback-result" required>
                    <option value="stopped" selected>stopped</option>
                    <option value="partially_stopped">partially_stopped</option>
                    <option value="previously_cancelled">previously_cancelled</option>
                    <option value="missed">missed</option>
                    <option value="notfound">notfound</option>
                    <option value="account_suspended">account_suspended</option>
                    <option value="shipper_contacted">shipper_contacted</option>
                    <option value="other">other</option>
                  </select>
                </div>

                <div class="form-field">
                  <label class="form-label">Refund Status *</label>
                  <div style="display: flex; gap: var(--spacing-md);">
                    <label style="display: flex; align-items: center; gap: var(--spacing-sm); cursor: pointer;">
                      <input type="radio" name="refund-status" value="refunded" checked onchange="toggleRefundFields(this.value)">
                      <span>Refunded</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: var(--spacing-sm); cursor: pointer;">
                      <input type="radio" name="refund-status" value="not_refunded" onchange="toggleRefundFields(this.value)">
                      <span>Not Refunded</span>
                    </label>
                  </div>
                </div>

                <div class="form-field">
                  <label class="form-label">Is Fraud</label>
                  <div style="display: flex; gap: var(--spacing-md);">
                    <label style="display: flex; align-items: center; gap: var(--spacing-sm); cursor: pointer;">
                      <input type="radio" name="is-fraud" value="true">
                      <span>Yes</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: var(--spacing-sm); cursor: pointer;">
                      <input type="radio" name="is-fraud" value="false">
                      <span>No</span>
                    </label>
                  </div>
                </div>

                <div class="form-field">
                  <label class="form-label">Additional Comments</label>
                  <textarea class="form-textarea" name="additional-comment" placeholder="Enter additional comments..." rows="3" maxlength="50"></textarea>
                  <small style="color: var(--gray-500);">Maximum 50 characters</small>
                </div>

                <div class="form-field">
                  <label class="form-label">Matching Transaction Reference</label>
                  <input type="text" class="form-input" name="transaction-ref" placeholder="Enter transaction reference" maxlength="50">
                  <small style="color: var(--gray-500);">Maximum 50 characters</small>
                </div>

                <!-- 退款相关字段 -->
                <div id="refund-fields">
                  <div class="form-field">
                    <label class="form-label">Refund ID *</label>
                    <input type="text" class="form-input" name="refund-id" placeholder="Enter refund ID" required>
                  </div>

                  <div class="form-field">
                    <label class="form-label">Refund Date *</label>
                    <input type="datetime-local" class="form-input" name="refund-date" required>
                  </div>

                  <div class="form-field">
                    <label class="form-label">Refund Currency *</label>
                    <select class="form-select" name="refund-currency" required>
                      <option value="">Select Currency</option>
                      <option value="USD">USD - US Dollar</option>
                      <option value="EUR">EUR - Euro</option>
                      <option value="CNY">CNY - Chinese Yuan</option>
                      <option value="GBP">GBP - British Pound</option>
                      <option value="JPY">JPY - Japanese Yen</option>
                      <option value="AUD">AUD - Australian Dollar</option>
                      <option value="CAD">CAD - Canadian Dollar</option>
                      <option value="CHF">CHF - Swiss Franc</option>
                      <option value="HKD">HKD - Hong Kong Dollar</option>
                      <option value="SGD">SGD - Singapore Dollar</option>
                    </select>
                  </div>

                  <div class="form-field">
                    <label class="form-label">Refund Amount *</label>
                    <input type="number" class="form-input" name="refund-amount" placeholder="Enter refund amount" step="0.01" min="0" required>
                    <small style="color: var(--gray-500);">Two decimal places</small>
                  </div>
                </div>
                
                <div style="display: flex; gap: var(--spacing-sm); justify-content: flex-end; padding-top: var(--spacing-lg); border-top: 1px solid var(--gray-200);">
                  <button type="button" class="btn btn-secondary" onclick="showPage('alerts')">Back</button>
                  <button type="submit" class="btn btn-primary">Submit Feedback</button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- 修改密码页面 -->
        <div id="change-password-content" class="content-page">
          <div class="change-password-container">
            <div class="page-header">
              <h1 class="page-title">Change Password</h1>
            </div>
            
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">Password Settings</h3>
              </div>
              <div class="card-body">
                <form class="password-form" onsubmit="handlePasswordChange(event)">
                  <div class="form-field">
                    <label class="form-label">Current Password *</label>
                    <input type="password" class="form-input" id="current-password" placeholder="Enter current password" required>
                    <div class="form-error" id="current-password-error">Current password is incorrect</div>
                  </div>
                  
                  <div class="form-field">
                    <label class="form-label">New Password *</label>
                    <input type="password" class="form-input" id="new-password" placeholder="Enter new password" required oninput="validateNewPassword()">
                    <div class="form-error" id="new-password-error">Password format is incorrect</div>
                    <div class="password-requirements">
                      <div class="requirement-item" id="req-length">
                        <span class="requirement-icon">✗</span>
                        <span>Password must be at least 6 characters</span>
                      </div>
                      <div class="requirement-item" id="req-different">
                        <span class="requirement-icon">✗</span>
                        <span>New password must be different from current password</span>
                      </div>
                    </div>
                  </div>
                  
                  <div class="form-field">
                    <label class="form-label">Confirm New Password *</label>
                    <input type="password" class="form-input" id="confirm-password" placeholder="Enter new password again" required oninput="validateConfirmPassword()">
                    <div class="form-error" id="confirm-password-error">Passwords do not match</div>
                    <div class="form-success" id="confirm-password-success">Password confirmation is correct</div>
                  </div>
                  
                  <div style="display: flex; gap: var(--spacing-sm); justify-content: flex-end; padding-top: var(--spacing-lg); border-top: 1px solid var(--gray-200);">
                    <button type="button" class="btn btn-secondary" onclick="showPage('descriptors')">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="submit-password-btn" disabled>Confirm Changes</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- 添加Descriptor弹窗 -->
  <div id="add-descriptor-modal" class="modal">
    <div class="modal-content">
      <div class="card-header">
        <h3 class="card-title">Add Descriptor</h3>
        <button class="btn btn-text" onclick="hideAddDescriptorModal()">✕</button>
      </div>
      <div class="card-body">
        <form class="card-form" onsubmit="handleAddDescriptor(event)">
          <div class="form-field">
            <label class="form-label">Alert Type *</label>
            <select class="form-select" id="alert-type-select" onchange="toggleAlertTypeFields()" required>
              <option value="">Select alert type</option>
              <option value="ETHOCA">ETHOCA</option>
              <option value="RDR">RDR</option>
            </select>
            <small style="color: var(--gray-500);">Choose the alert service type</small>
          </div>
          
          <div class="form-field">
            <label class="form-label">Descriptor *</label>
            <input type="text" class="form-input" placeholder="Enter descriptor" required id="descriptor-input">
            <small style="color: var(--gray-500);">Merchant identifier for alert service</small>
          </div>
          
          <div class="form-field" id="bin-field" style="display: none;">
            <label class="form-label">BIN *</label>
            <input type="text" class="form-input" placeholder="Enter 6-8 digit BIN" pattern="[0-9]{6,8}" id="bin-input">
            <small style="color: var(--gray-500);">Bank Identification Number</small>
          </div>
          
          <div class="form-field" id="caid-field" style="display: none;">
            <label class="form-label">CAID *</label>
            <input type="text" class="form-input" placeholder="Enter CAID" id="caid-input">
            <small style="color: var(--gray-500);">Customer Authorization Identifier</small>
          </div>
          
          <div class="form-field">
            <label class="form-label">Notification Email *</label>
            <input type="email" class="form-input" placeholder="Email for alert notifications" required id="email-input">
          </div>
          
          <div style="display: flex; gap: var(--spacing-sm); justify-content: flex-end;">
            <button type="button" class="btn btn-secondary" onclick="hideAddDescriptorModal()">Cancel</button>
            <button type="submit" class="btn btn-primary">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // Mock Descriptor data
    let descriptorsData = [
      { id: 1, alertType: 'ETHOCA', descriptor: 'ABC-STORE', bin: '-', caid: '-', status: 'Registered', createTime: '2024-12-01 14:30:25', email: 'alert@abc.com' },
      { id: 2, alertType: 'RDR', descriptor: 'XYZ-SHOP', bin: '512345', caid: 'CA001', status: 'Pending', createTime: '2024-12-01 13:15:10', email: 'notify@xyz.com' },
      { id: 3, alertType: 'ETHOCA', descriptor: 'BEST-MALL', bin: '-', caid: '-', status: 'Registered', createTime: '2024-11-30 16:45:30', email: 'alerts@best.com' },
      { id: 4, alertType: 'RDR', descriptor: 'TECH-STORE', bin: '378901', caid: 'CA002', status: 'Closed', createTime: '2024-11-30 11:20:15', email: 'tech@store.com' },
      { id: 5, alertType: 'ETHOCA', descriptor: 'GAME-WORLD', bin: '-', caid: '-', status: 'Registered', createTime: '2024-11-29 09:30:45', email: 'game@world.com' },
      { id: 6, alertType: 'RDR', descriptor: 'FOOD-HUB', bin: '987654', caid: 'CA003', status: 'Pending', createTime: '2024-11-29 08:15:20', email: 'food@hub.com' },
      { id: 7, alertType: 'ETHOCA', descriptor: 'BOOK-STORE', bin: '-', caid: '-', status: 'Registered', createTime: '2024-11-28 15:40:10', email: 'book@store.com' },
      { id: 8, alertType: 'RDR', descriptor: 'AUTO-PARTS', bin: '567890', caid: 'CA004', status: 'Closed', createTime: '2024-11-28 12:25:35', email: 'auto@parts.com' },
      { id: 9, alertType: 'ETHOCA', descriptor: 'MUSIC-SHOP', bin: '-', caid: '-', status: 'Registered', createTime: '2024-11-27 17:10:50', email: 'music@shop.com' },
      { id: 10, alertType: 'RDR', descriptor: 'SPORT-GEAR', bin: '876543', caid: 'CA005', status: 'Pending', createTime: '2024-11-27 14:55:25', email: 'sport@gear.com' },
      { id: 11, alertType: 'ETHOCA', descriptor: 'HOME-DECO', bin: '-', caid: '-', status: 'Registered', createTime: '2024-11-26 10:30:15', email: 'home@deco.com' },
      { id: 12, alertType: 'RDR', descriptor: 'PET-CARE', bin: '789012', caid: 'CA006', status: 'Closed', createTime: '2024-11-26 08:45:40', email: 'pet@care.com' },
      { id: 13, alertType: 'ETHOCA', descriptor: 'HEALTH-PLUS', bin: '-', caid: '-', status: 'Registered', createTime: '2024-11-25 16:20:30', email: 'health@plus.com' },
      { id: 14, alertType: 'RDR', descriptor: 'BEAUTY-SPA', bin: '246802', caid: 'CA007', status: 'Pending', createTime: '2024-11-25 13:35:55', email: 'beauty@spa.com' },
      { id: 15, alertType: 'ETHOCA', descriptor: 'TRAVEL-GO', bin: '-', caid: '-', status: 'Registered', createTime: '2024-11-24 11:15:20', email: 'travel@go.com' },
      { id: 16, alertType: 'RDR', descriptor: 'KIDS-TOYS', bin: '468024', caid: 'CA008', status: 'Closed', createTime: '2024-11-24 09:50:45', email: 'kids@toys.com' },
      { id: 17, alertType: 'ETHOCA', descriptor: 'OFFICE-SUPPLY', bin: '-', caid: '-', status: 'Registered', createTime: '2024-11-23 15:25:10', email: 'office@supply.com' },
      { id: 18, alertType: 'RDR', descriptor: 'GARDEN-CENTER', bin: '680246', caid: 'CA009', status: 'Pending', createTime: '2024-11-23 12:40:35', email: 'garden@center.com' }
    ];

    let filteredData = [...descriptorsData];
    let currentPage = 1;
    let itemsPerPage = 10;

    // Mock Alert Data
    let alertsData = [
      {
        id: 1,
        alertId: 'CHB_20241201_001',
        receiveTime: '2024-12-01 14:30:25',
        alertTime: '2024-12-01 14:28:10',
        disputeType: 'fraud',
        source: 'V-Card',
        amount: '1250.00 USD',
        description: 'Customer claims unauthorized transaction',
        status: 'Pending',
        // V-Card specific fields
        cardBin: '418756',
        caid: 'CA001234',
        cardNumber: '****1234',
        acquirerBin: '123456',
        acquirerRef: 'REF123456789',
        authCode: 'AUTH123',
        reasonCode: '10.4',
        contact: 'John Smith',
        disputeAmount: '1250.00 USD',
        mcc: '5411',
        ruleName: 'Unauthorized Transaction Rule',
        ruleType: 'Fraud Prevention',
        transactionDate: '2024-11-30'
      },
      {
        id: 2,
        alertId: 'CHB_20241201_002',
        receiveTime: '2024-12-01 13:45:10',
        alertTime: '2024-12-01 13:42:55',
        disputeType: 'dispute',
        source: 'MasterCard',
        amount: '850.00 USD',
        description: 'Duplicate transaction processing detected',
        status: 'Processing',
        // M卡特有字段
        arn: '12345678901234567890123',
        authCode: 'AUTH456',
        cardBin: '512345',
        cardNumber: '****5678',
        reasonCode: '4837',
        disputeAmount: '850.00 USD',
        initiatedBy: 'Cardholder',
        issuerName: 'China Merchants Bank',
        liability3D: 'No',
        mcc: '5999',
        transactionId: 'TXN_987654322',
        transactionTime: '2024-11-30 15:30:20',
        transactionType: 'Online Payment'
      },
      {
        id: 3,
        alertId: 'CHB_20241130_003',
        receiveTime: '2024-11-30 16:20:30',
        alertTime: '2024-11-30 16:18:45',
        disputeType: 'dispute',
        source: 'Visa Card',
        amount: '320.00 USD',
        description: 'Customer dispute regarding product quality',
        status: 'Processed',
        cardBin: '456789',
        caid: 'CA005678',
        cardNumber: '****9876',
        acquirerBin: '654321',
        acquirerRef: 'REF987654321',
        authCode: 'AUTH789',
        reasonCode: '13.1',
        contact: 'Alice Johnson',
        disputeAmount: '320.00 USD',
        mcc: '5732',
        ruleName: 'Product Quality Rule',
        ruleType: 'Consumer Protection',
        transactionDate: '2024-11-28'
      },
      {
        id: 4,
        alertId: 'CHB_20241130_004',
        receiveTime: '2024-11-30 11:15:20',
        alertTime: '2024-11-30 11:12:35',
        disputeType: 'fraud',
        source: 'MasterCard',
        amount: '1500.00 USD',
        description: 'Error occurred during transaction processing',
        status: 'Rejected',
        arn: '98765432109876543210987',
        authCode: 'AUTH321',
        cardBin: '378901',
        cardNumber: '****4321',
        reasonCode: '4855',
        disputeAmount: '1500.00 USD',
        initiatedBy: 'Merchant',
        issuerName: 'Industrial and Commercial Bank of China',
        liability3D: 'Yes',
        mcc: '5812',
        transactionId: 'TXN_456789123',
        transactionTime: '2024-11-29 10:45:15',
        transactionType: 'Mobile Payment'
      },
      {
        id: 5,
        alertId: 'CHB_20241129_005',
        receiveTime: '2024-11-29 09:30:45',
        alertTime: '2024-11-29 09:28:20',
        disputeType: 'fraud',
        source: 'Visa Card',
        amount: '2100.00 USD',
        description: 'Suspected fraudulent transaction activity',
        status: 'Pending',
        cardBin: '123456',
        caid: 'CA009876',
        cardNumber: '****5555',
        acquirerBin: '789012',
        acquirerRef: 'REF555666777',
        authCode: 'AUTH555',
        reasonCode: '10.5',
        contact: 'Bob Wilson',
        disputeAmount: '2100.00 USD',
        mcc: '5499',
        ruleName: 'Fraud Detection Rule',
        ruleType: 'Risk Control',
        transactionDate: '2024-11-27'
      }
    ];

    let filteredAlertsData = [...alertsData];
    let currentAlertsPage = 1;
    let alertsPerPage = 10;

    // 页面切换功能
    function showPage(pageId) {
      // 隐藏所有内容页面
      const contentPages = document.querySelectorAll('.content-page');
      contentPages.forEach(page => {
        page.classList.remove('active');
        page.style.display = 'none';
      });
      
      // 显示目标页面
      const targetPage = document.getElementById(pageId + '-content');
      if (targetPage) {
        targetPage.classList.add('active');
        targetPage.style.display = 'block';
        targetPage.classList.add('fade-in');
        
        // 如果是密码修改页面，初始化事件监听器
        if (pageId === 'change-password') {
          setTimeout(() => {
            initializePasswordChangeListeners();
          }, 100);
        }
      }
      
      // 更新导航状态
      const navItems = document.querySelectorAll('.nav-item');
      navItems.forEach(item => {
        item.classList.remove('active');
      });
      
      // 根据页面ID设置对应的导航项为活跃状态
      const navMap = {
        'descriptors': 0,
        'alerts': 1,
        'alert-detail': 1,
        'change-password': -1 // 不激活任何导航项
      };
      
      const activeIndex = navMap[pageId];
      if (activeIndex !== undefined) {
        navItems[activeIndex].classList.add('active');
      }
    }

    // 登录处理
    function handleLogin(event) {
      event.preventDefault();
      
      const email = event.target.querySelector('input[type="email"]').value.trim();
      const password = event.target.querySelector('input[type="password"]').value;
      
      // Email validation
      if (!email) {
        alert('Please enter email');
        return;
      }
      
      // Password validation
      if (!password) {
        alert('Please enter password');
        return;
      }
      
      // Simulate database validation
      const validEmails = ['admin@example.com', 'merchant@abc.com', 'test@test.com'];
      const validCredentials = {
        'admin@example.com': '123456',
        'merchant@abc.com': 'password',
        'test@test.com': '123456'
      };
      
      // Check if email exists
      if (!validEmails.includes(email)) {
        alert('Email does not exist');
        return;
      }
      
      // Check if password is correct
      if (validCredentials[email] !== password) {
        alert('Incorrect password');
        return;
      }
      
      // Login successful
      document.getElementById('login-page').classList.remove('active');
      document.getElementById('app-page').classList.add('active');
      
      showPage('descriptors');
      document.getElementById('app-page').classList.add('fade-in');
    }

    // 退出登录
    function handleLogout() {
      document.getElementById('app-page').classList.remove('active');
      document.getElementById('login-page').classList.add('active');
      
      const loginForm = document.querySelector('.login-form');
      loginForm.reset();
      
      // 关闭用户下拉菜单
      document.getElementById('user-dropdown').classList.remove('active');
    }

    // 显示添加Descriptor弹窗
    function showAddDescriptorModal() {
      document.getElementById('add-descriptor-modal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    // 隐藏添加Descriptor弹窗
    function hideAddDescriptorModal() {
      document.getElementById('add-descriptor-modal').classList.remove('active');
      document.body.style.overflow = 'auto';
      
      // 重置表单
      const form = document.querySelector('#add-descriptor-modal form');
      form.reset();
      document.getElementById('bin-field').style.display = 'none';
      document.getElementById('caid-field').style.display = 'none';
      document.getElementById('bin-input').required = false;
      document.getElementById('caid-input').required = false;
    }

    // 切换预警类型字段显示
    function toggleAlertTypeFields() {
      const alertType = document.getElementById('alert-type-select').value;
      const binField = document.getElementById('bin-field');
      const caidField = document.getElementById('caid-field');
      const binInput = document.getElementById('bin-input');
      const caidInput = document.getElementById('caid-input');
      
      if (alertType === 'ETHOCA') {
        binField.style.display = 'none';
        caidField.style.display = 'none';
        binInput.required = false;
        caidInput.required = false;
        binInput.value = '';
        caidInput.value = '';
      } else if (alertType === 'RDR') {
        binField.style.display = 'block';
        caidField.style.display = 'block';
        binInput.required = true;
        caidInput.required = true;
      } else {
        binField.style.display = 'none';
        caidField.style.display = 'none';
        binInput.required = false;
        caidInput.required = false;
      }
    }

    // 处理添加Descriptor
    function handleAddDescriptor(event) {
      event.preventDefault();
      
      const alertType = document.getElementById('alert-type-select').value;
      const descriptor = document.getElementById('descriptor-input').value.trim();
      const bin = document.getElementById('bin-input').value.trim();
      const caid = document.getElementById('caid-input').value.trim();
      const email = document.getElementById('email-input').value.trim();
      
      if (!alertType) {
        alert('Please select alert type');
        return;
      }
      
      if (!descriptor) {
        alert('Please enter descriptor');
        return;
      }
      
      if (!email) {
        alert('Please enter notification email');
        return;
      }
      
      // RDR类型需要验证BIN和CAID
      if (alertType === 'RDR') {
        if (!bin) {
          alert('BIN is required for RDR type');
          return;
        }
        if (!caid) {
          alert('CAID is required for RDR type');
          return;
        }
      }
      
      // 添加新Descriptor
      const newDescriptor = {
        id: descriptorsData.length + 1,
        alertType: alertType,
        descriptor: descriptor,
        bin: alertType === 'ETHOCA' ? '-' : bin,
        caid: alertType === 'ETHOCA' ? '-' : caid,
        status: 'Pending',
        createTime: new Date().toISOString().slice(0, 19).replace('T', ' '),
        email: email
      };
      
      descriptorsData.unshift(newDescriptor);
      filteredData = [...descriptorsData];
      
      alert('Descriptor registration submitted successfully!');
      hideAddDescriptorModal();
      renderTable();
      updatePagination();
    }

    // 渲染表格
    function renderTable() {
      const tbody = document.getElementById('descriptors-table-body');
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = startIndex + itemsPerPage;
      const currentData = filteredData.slice(startIndex, endIndex);
      
      tbody.innerHTML = currentData.map(item => `
        <tr class="table-row">
          <td>
            <span class="badge ${item.alertType === 'ETHOCA' ? 'badge-ethoca' : 'badge-rdr'}">${item.alertType}</span>
          </td>
          <td>${item.descriptor}</td>
          <td style="font-family: var(--font-family-number);">${item.bin}</td>
          <td>${item.caid}</td>
          <td>
            <span class="badge ${getStatusClass(item.status)}">${item.status}</span>
          </td>
          <td>${item.createTime}</td>
          <td>
            ${item.status === 'Registered' ? 
              `<button class="btn btn-text" style="color: var(--danger);" onclick="closeDescriptor(${item.id})">Close</button>` :
              '<span style="color: var(--gray-400);">-</span>'
            }
          </td>
        </tr>
      `).join('');
    }

    // 获取状态样式类
    function getStatusClass(status) {
      switch(status) {
        case 'Registered': return 'badge-success';
        case 'Pending': return 'badge-warning';
        case 'Closed': return 'badge-danger';
        default: return 'badge-secondary';
      }
    }

    // 关闭Descriptor
    function closeDescriptor(descriptorId) {
      if (confirm('Are you sure you want to close this descriptor?')) {
        const descriptorIndex = descriptorsData.findIndex(item => item.id === descriptorId);
        if (descriptorIndex !== -1) {
          descriptorsData[descriptorIndex].status = 'Closed';
          applyFilters();
          alert('Descriptor has been closed successfully!');
        }
      }
    }

    // 应用筛选
    function applyFilters() {
      const alertType = document.getElementById('filter-alert-type').value;
      const descriptor = document.getElementById('filter-descriptor').value.trim().toLowerCase();
      const dateStart = document.getElementById('filter-date-start').value;
      const dateEnd = document.getElementById('filter-date-end').value;
      const status = document.getElementById('filter-status').value;
      
      filteredData = descriptorsData.filter(item => {
        let match = true;
        
        if (alertType && item.alertType !== alertType) {
          match = false;
        }
        
        if (descriptor && !item.descriptor.toLowerCase().includes(descriptor)) {
          match = false;
        }
        
        if (dateStart) {
          const itemDate = new Date(item.createTime);
          const startDate = new Date(dateStart);
          if (itemDate < startDate) {
            match = false;
          }
        }
        
        if (dateEnd) {
          const itemDate = new Date(item.createTime);
          const endDate = new Date(dateEnd + ' 23:59:59');
          if (itemDate > endDate) {
            match = false;
          }
        }
        
        if (status && item.status !== status) {
          match = false;
        }
        
        return match;
      });
      
      currentPage = 1;
      renderTable();
      updatePagination();
    }

    // 重置筛选
    function resetFilters() {
      document.getElementById('filter-alert-type').value = '';
      document.getElementById('filter-descriptor').value = '';
      document.getElementById('filter-date-start').value = '';
      document.getElementById('filter-date-end').value = '';
      document.getElementById('filter-status').value = '';
      
      filteredData = [...descriptorsData];
      currentPage = 1;
      renderTable();
      updatePagination();
    }

    // 更新分页
    function updatePagination() {
      const totalPages = Math.ceil(filteredData.length / itemsPerPage);
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = Math.min(startIndex + itemsPerPage, filteredData.length);
      
      // 更新分页信息
      document.getElementById('pagination-info').textContent = 
        `Showing ${startIndex + 1}-${endIndex} of ${filteredData.length} records`;
      
      // 更新按钮状态
      document.getElementById('prev-btn').disabled = currentPage === 1;
      document.getElementById('next-btn').disabled = currentPage === totalPages;
      
      // 更新页码
      const pageNumbers = document.getElementById('page-numbers');
      pageNumbers.innerHTML = '';
      
      for (let i = 1; i <= totalPages; i++) {
        const pageBtn = document.createElement('button');
        pageBtn.textContent = i;
        pageBtn.style.cssText = `
          width: 36px; height: 36px; 
          border: 1px solid ${i === currentPage ? 'var(--primary-orange)' : 'var(--gray-200)'}; 
          background: ${i === currentPage ? 'var(--primary-orange)' : 'var(--bg-primary)'}; 
          color: ${i === currentPage ? 'white' : 'inherit'}; 
          border-radius: var(--border-radius-md); 
          cursor: pointer;
        `;
        pageBtn.onclick = () => goToPage(i);
        pageNumbers.appendChild(pageBtn);
      }
    }

    // 切换页面
    function changePage(direction) {
      const totalPages = Math.ceil(filteredData.length / itemsPerPage);
      const newPage = currentPage + direction;
      
      if (newPage >= 1 && newPage <= totalPages) {
        currentPage = newPage;
        renderTable();
        updatePagination();
      }
    }

    // 跳转到指定页面
    function goToPage(page) {
      currentPage = page;
      renderTable();
      updatePagination();
    }

    // 禁用卡片功能 (保留原有功能兼容性)
    function disableCard(button, cardName) {
      if (confirm(`Are you sure you want to disable ${cardName}?`)) {
        const cardItem = button.closest('.card-item');
        const statusBadge = cardItem.querySelector('.badge');
        const actionContainer = cardItem.querySelector('div:last-child');
        
        statusBadge.className = 'badge badge-danger';
        statusBadge.textContent = 'Disabled';
        
        actionContainer.innerHTML = '<button class="btn btn-text" style="color: var(--success);" onclick="enableCard(this, \'' + cardName + '\')">Enable</button>';
        
        alert(`${cardName} has been disabled successfully!`);
      }
    }

    // 启用卡片功能 (保留原有功能兼容性)
    function enableCard(button, cardName) {
      if (confirm(`Are you sure you want to enable ${cardName}?`)) {
        const cardItem = button.closest('.card-item');
        const statusBadge = cardItem.querySelector('.badge');
        const actionContainer = cardItem.querySelector('div:last-child');
        
        statusBadge.className = 'badge badge-success';
        statusBadge.textContent = 'Registered';
        
        actionContainer.innerHTML = `
          <button class="btn btn-text">Edit</button>
          <button class="btn btn-text" style="color: var(--danger);" onclick="disableCard(this, '${cardName}')">Disable</button>
        `;
        
        alert(`${cardName} has been enabled successfully!`);
      }
    }

    // 处理预警
    function handleProcessAlert(event) {
      event.preventDefault();
      
      const formData = new FormData(event.target);
      const action = formData.get('action');
      const reason = event.target.querySelector('textarea').value;
      
      if (!action) {
        alert('Please select an action');
        return;
      }
      
      if (!reason.trim()) {
        alert('Please provide a reason');
        return;
      }
      
      alert('Alert processing submitted successfully!');
      showPage('alerts');
    }

    // 点击弹窗外部关闭弹窗
    document.addEventListener('click', function(e) {
      const modal = document.getElementById('add-descriptor-modal');
      if (e.target === modal) {
        hideAddDescriptorModal();
      }
    });

    // ESC键关闭弹窗
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        hideAddDescriptorModal();
      }
    });

    // 初始化页面
    document.addEventListener('DOMContentLoaded', function() {
      showPage('descriptors');
      renderTable();
      updatePagination();
      renderAlertsTable();
      updateAlertsPagination();
      
      // 添加表格行点击效果
      const tableRows = document.querySelectorAll('.table-row');
      tableRows.forEach(row => {
        row.addEventListener('click', function(e) {
          if (e.target.tagName === 'BUTTON' || e.target.closest('button')) {
            return;
          }
          
          tableRows.forEach(r => r.style.backgroundColor = '');
          this.style.backgroundColor = 'var(--primary-orange-pale)';
        });
      });
      
      // 添加卡片悬停效果
      const cards = document.querySelectorAll('.card');
      cards.forEach(card => {
        card.addEventListener('mouseenter', function() {
          this.style.transform = 'translateY(-2px)';
          this.style.boxShadow = 'var(--shadow-lg)';
        });
        
        card.addEventListener('mouseleave', function() {
          this.style.transform = 'translateY(0)';
          this.style.boxShadow = 'var(--shadow-sm)';
        });
      });
    });

    // 响应式处理
    function handleResize() {
      const isMobile = window.innerWidth <= 768;
      const sidebar = document.querySelector('.app-sidebar');
      
      if (isMobile) {
        sidebar.style.display = 'none';
      } else {
        sidebar.style.display = 'block';
      }
    }

    window.addEventListener('resize', handleResize);
    window.addEventListener('load', handleResize);

    // 预警相关函数
    // 渲染预警表格
    function renderAlertsTable() {
      const tbody = document.getElementById('alerts-table-body');
      const startIndex = (currentAlertsPage - 1) * alertsPerPage;
      const endIndex = startIndex + alertsPerPage;
      const currentData = filteredAlertsData.slice(startIndex, endIndex);
      
      tbody.innerHTML = currentData.map(alert => `
        <tr class="table-row">
          <td>${alert.receiveTime}</td>
          <td>
            <span class="badge ${getDisputeTypeClass(alert.disputeType)}">${alert.disputeType}</span>
          </td>
          <td>
            <span class="badge ${alert.source === 'Visa Card' ? 'badge-info' : 'badge-secondary'}">${alert.source}</span>
          </td>
          <td style="font-family: var(--font-family-number);">${alert.amount}</td>
          <td>${alert.description}</td>
          <td>
            <span class="badge ${getAlertStatusClass(alert.status)}">${alert.status}</span>
          </td>
          <td>
            <button class="btn btn-text" onclick="showAlertDetail(${alert.id})">View Details</button>
          </td>
        </tr>
      `).join('');
    }

    // Get dispute type style class
    function getDisputeTypeClass(type) {
      switch(type) {
        case 'fraud': return 'badge-danger';
        case 'dispute': return 'badge-warning';
        default: return 'badge-secondary';
      }
    }

    // 获取预警状态样式类
    function getAlertStatusClass(status) {
      switch(status) {
        case 'Pending': return 'badge-warning';
        case 'Processing': return 'badge-info';
        case 'Processed': return 'badge-success';
        case 'Rejected': return 'badge-danger';
        default: return 'badge-secondary';
      }
    }

    // 显示预警详情
    function showAlertDetail(alertId) {
      const alert = alertsData.find(item => item.id === alertId);
      if (!alert) return;

      // 更新基础信息
      document.getElementById('detail-alert-id').textContent = alert.alertId;
      document.getElementById('detail-dispute-type').textContent = alert.disputeType;
      document.getElementById('detail-dispute-type').className = `badge ${getDisputeTypeClass(alert.disputeType)}`;
      document.getElementById('detail-status').textContent = alert.status;
      document.getElementById('detail-status').className = `badge ${getAlertStatusClass(alert.status)}`;
      document.getElementById('detail-receive-time').textContent = alert.receiveTime;
      document.getElementById('detail-alert-time').textContent = alert.alertTime;
      document.getElementById('detail-alert-id-copy').textContent = alert.alertId;
      document.getElementById('detail-dispute-type-copy').textContent = alert.disputeType;
      document.getElementById('detail-source').textContent = alert.source;
      document.getElementById('detail-amount').textContent = alert.amount;
      document.getElementById('detail-description').textContent = alert.description;

      // 根据预警来源显示不同的详细信息
      const visaDetails = document.getElementById('visa-details');
      const mastercardDetails = document.getElementById('mastercard-details');
      const feedbackSection = document.getElementById('feedback-section');

      if (alert.source === 'Visa Card') {
        // 显示V卡信息
        visaDetails.style.display = 'block';
        mastercardDetails.style.display = 'none';
        feedbackSection.style.display = 'none';

        // 填充V卡数据
        document.getElementById('visa-bin').textContent = alert.cardBin;
        document.getElementById('visa-caid').textContent = alert.caid;
        document.getElementById('visa-card-number').textContent = alert.cardNumber;
        document.getElementById('visa-acquirer-bin').textContent = alert.acquirerBin;
        document.getElementById('visa-acquirer-ref').textContent = alert.acquirerRef;
        document.getElementById('visa-auth-code').textContent = alert.authCode;
        document.getElementById('visa-reason-code').textContent = alert.reasonCode;
        document.getElementById('visa-contact').textContent = alert.contact;
        document.getElementById('visa-dispute-amount').textContent = alert.disputeAmount;
        document.getElementById('visa-mcc').textContent = alert.mcc;
        document.getElementById('visa-rule-name').textContent = alert.ruleName;
        document.getElementById('visa-rule-type').textContent = alert.ruleType;
        document.getElementById('visa-transaction-date').textContent = alert.transactionDate;
      } else {
        // 显示M卡信息
        visaDetails.style.display = 'none';
        mastercardDetails.style.display = 'block';
        feedbackSection.style.display = 'block';

        // 填充M卡数据
        document.getElementById('mc-arn').textContent = alert.arn;
        document.getElementById('mc-auth-code').textContent = alert.authCode;
        document.getElementById('mc-bin').textContent = alert.cardBin;
        document.getElementById('mc-card-number').textContent = alert.cardNumber;
        document.getElementById('mc-reason-code').textContent = alert.reasonCode;
        document.getElementById('mc-dispute-amount').textContent = alert.disputeAmount;
        document.getElementById('mc-initiated-by').textContent = alert.initiatedBy;
        document.getElementById('mc-issuer-name').textContent = alert.issuerName;
        document.getElementById('mc-3d-liability').textContent = alert.liability3D;
        document.getElementById('mc-mcc').textContent = alert.mcc;
        document.getElementById('mc-transaction-id').textContent = alert.transactionId;
        document.getElementById('mc-transaction-time').textContent = alert.transactionTime;
        document.getElementById('mc-transaction-type').textContent = alert.transactionType;
      }

      showPage('alert-detail');
    }

    // 应用预警筛选
    function applyAlertFilters() {
      const disputeType = document.getElementById('filter-dispute-type').value;
      const processStatus = document.getElementById('filter-process-status').value;
      const receiveStart = document.getElementById('filter-receive-start').value;
      const receiveEnd = document.getElementById('filter-receive-end').value;
      
      filteredAlertsData = alertsData.filter(alert => {
        let match = true;
        
        if (disputeType && alert.disputeType !== disputeType) {
          match = false;
        }
        
        if (processStatus && alert.status !== processStatus) {
          match = false;
        }
        
        if (receiveStart) {
          const alertDate = new Date(alert.receiveTime);
          const startDate = new Date(receiveStart);
          if (alertDate < startDate) {
            match = false;
          }
        }
        
        if (receiveEnd) {
          const alertDate = new Date(alert.receiveTime);
          const endDate = new Date(receiveEnd + ' 23:59:59');
          if (alertDate > endDate) {
            match = false;
          }
        }
        
        return match;
      });
      
      currentAlertsPage = 1;
      renderAlertsTable();
      updateAlertsPagination();
    }

    // 重置预警筛选
    function resetAlertFilters() {
      document.getElementById('filter-dispute-type').value = '';
      document.getElementById('filter-process-status').value = '';
      document.getElementById('filter-receive-start').value = '';
      document.getElementById('filter-receive-end').value = '';
      
      filteredAlertsData = [...alertsData];
      currentAlertsPage = 1;
      renderAlertsTable();
      updateAlertsPagination();
    }

    // 更新预警分页
    function updateAlertsPagination() {
      const totalPages = Math.ceil(filteredAlertsData.length / alertsPerPage);
      const startIndex = (currentAlertsPage - 1) * alertsPerPage;
      const endIndex = Math.min(startIndex + alertsPerPage, filteredAlertsData.length);
      
      // 更新分页信息
      document.getElementById('alerts-pagination-info').textContent = 
        `Showing ${startIndex + 1}-${endIndex} of ${filteredAlertsData.length} records`;
      
      // 更新按钮状态
      document.getElementById('alerts-prev-btn').disabled = currentAlertsPage === 1;
      document.getElementById('alerts-next-btn').disabled = currentAlertsPage === totalPages || totalPages === 0;
      
      // 更新页码
      const pageNumbers = document.getElementById('alerts-page-numbers');
      pageNumbers.innerHTML = '';
      
      for (let i = 1; i <= totalPages; i++) {
        const pageBtn = document.createElement('button');
        pageBtn.textContent = i;
        pageBtn.style.cssText = `
          width: 36px; height: 36px; 
          border: 1px solid ${i === currentAlertsPage ? 'var(--primary-orange)' : 'var(--gray-200)'}; 
          background: ${i === currentAlertsPage ? 'var(--primary-orange)' : 'var(--bg-primary)'}; 
          color: ${i === currentAlertsPage ? 'white' : 'inherit'}; 
          border-radius: var(--border-radius-md); 
          cursor: pointer;
        `;
        pageBtn.onclick = () => goToAlertsPage(i);
        pageNumbers.appendChild(pageBtn);
      }
    }

    // 切换预警页面
    function changeAlertsPage(direction) {
      const totalPages = Math.ceil(filteredAlertsData.length / alertsPerPage);
      const newPage = currentAlertsPage + direction;
      
      if (newPage >= 1 && newPage <= totalPages) {
        currentAlertsPage = newPage;
        renderAlertsTable();
        updateAlertsPagination();
      }
    }

    // 跳转到指定预警页面
    function goToAlertsPage(page) {
      currentAlertsPage = page;
      renderAlertsTable();
      updateAlertsPagination();
    }

    // 处理预警反馈
    function handleAlertFeedback(event) {
      event.preventDefault();
      
      const formData = new FormData(event.target);
      const feedbackResult = formData.get('feedback-result');
      const refundStatus = formData.get('refund-status');
      const isFraud = formData.get('is-fraud');
      const additionalComment = formData.get('additional-comment');
      const transactionRef = formData.get('transaction-ref');
      
      // 验证必填字段
      if (!feedbackResult) {
        alert('Please select feedback result');
        return;
      }
      
      if (!refundStatus) {
        alert('Please select refund status');
        return;
      }
      
      // 如果选择已退款，验证退款相关字段
      if (refundStatus === 'refunded') {
        const refundId = formData.get('refund-id');
        const refundDate = formData.get('refund-date');
        const refundCurrency = formData.get('refund-currency');
        const refundAmount = formData.get('refund-amount');
        
        if (!refundId || !refundId.trim()) {
          alert('Please enter refund ID');
          return;
        }
        
        if (!refundDate) {
          alert('Please select refund date');
          return;
        }
        
        if (!refundCurrency) {
          alert('Please select refund currency');
          return;
        }
        
        if (!refundAmount || parseFloat(refundAmount) <= 0) {
          alert('Please enter a valid refund amount');
          return;
        }
      }
      
      // 验证字符长度限制
      if (additionalComment && additionalComment.length > 50) {
        alert('Additional comments cannot exceed 50 characters');
        return;
      }
      
      if (transactionRef && transactionRef.length > 50) {
        alert('Transaction reference cannot exceed 50 characters');
        return;
      }
      
      // 提交成功后禁用表单
      const form = document.getElementById('feedback-form');
      const formElements = form.querySelectorAll('input, select, textarea, button');
      formElements.forEach(element => {
        element.disabled = true;
      });
      
      // 添加提交成功标识
      const cardHeader = form.closest('.card').querySelector('.card-header');
      cardHeader.innerHTML = '<h3 class="card-title">Feedback <span class="badge badge-success">Submitted</span></h3>';
      
      alert('Alert feedback submitted successfully!');
      showPage('alerts');
    }

    // 控制退款字段显示隐藏
    function toggleRefundFields(status) {
      const refundFields = document.getElementById('refund-fields');
      const refundInputs = refundFields.querySelectorAll('input, select');
      
      if (status === 'refunded') {
        refundFields.style.display = 'block';
        refundInputs.forEach(input => {
          input.required = true;
        });
      } else {
        refundFields.style.display = 'none';
        refundInputs.forEach(input => {
          input.required = false;
          input.value = '';
        });
      }
    }

    // 用户下拉菜单控制
    function toggleUserDropdown() {
      const dropdown = document.getElementById('user-dropdown');
      dropdown.classList.toggle('active');
    }

    // 点击外部关闭下拉菜单
    document.addEventListener('click', function(e) {
      const userMenu = document.querySelector('.user-menu');
      const dropdown = document.getElementById('user-dropdown');
      
      if (!userMenu.contains(e.target)) {
        dropdown.classList.remove('active');
      }
    });

    // 修改密码相关变量
    let currentUserPassword = 'password123'; // 模拟当前用户密码

    // 验证新密码
    function validateNewPassword() {
      const newPassword = document.getElementById('new-password').value;
      const currentPassword = document.getElementById('current-password').value;
      const newPasswordInput = document.getElementById('new-password');
      const lengthReq = document.getElementById('req-length');
      const differentReq = document.getElementById('req-different');
      
      // 检查密码长度
      if (newPassword.length >= 6) {
        lengthReq.classList.add('valid');
        lengthReq.classList.remove('invalid');
        lengthReq.querySelector('.requirement-icon').textContent = '✓';
      } else {
        lengthReq.classList.add('invalid');
        lengthReq.classList.remove('valid');
        lengthReq.querySelector('.requirement-icon').textContent = '✗';
      }
      
      // 检查新密码是否与当前密码不同
      if (newPassword && newPassword !== currentPassword) {
        differentReq.classList.add('valid');
        differentReq.classList.remove('invalid');
        differentReq.querySelector('.requirement-icon').textContent = '✓';
      } else {
        differentReq.classList.add('invalid');
        differentReq.classList.remove('valid');
        differentReq.querySelector('.requirement-icon').textContent = '✗';
      }
      
      // 更新输入框状态
      if (newPassword.length >= 6 && newPassword !== currentPassword) {
        newPasswordInput.classList.remove('error');
        newPasswordInput.classList.add('success');
        document.getElementById('new-password-error').style.display = 'none';
      } else if (newPassword.length > 0) {
        newPasswordInput.classList.add('error');
        newPasswordInput.classList.remove('success');
        if (newPassword.length < 6) {
          document.getElementById('new-password-error').textContent = 'Password must be at least 6 characters';
          document.getElementById('new-password-error').style.display = 'block';
        } else if (newPassword === currentPassword) {
          document.getElementById('new-password-error').textContent = 'New password must be different from current password';
          document.getElementById('new-password-error').style.display = 'block';
        }
      } else {
        newPasswordInput.classList.remove('error', 'success');
        document.getElementById('new-password-error').style.display = 'none';
      }
      
      validateConfirmPassword();
      updateSubmitButton();
    }

    // 验证确认密码
    function validateConfirmPassword() {
      const newPassword = document.getElementById('new-password').value;
      const confirmPassword = document.getElementById('confirm-password').value;
      const confirmPasswordInput = document.getElementById('confirm-password');
      const errorElement = document.getElementById('confirm-password-error');
      const successElement = document.getElementById('confirm-password-success');
      
      if (confirmPassword.length === 0) {
        confirmPasswordInput.classList.remove('error', 'success');
        errorElement.style.display = 'none';
        successElement.style.display = 'none';
      } else if (confirmPassword === newPassword) {
        confirmPasswordInput.classList.remove('error');
        confirmPasswordInput.classList.add('success');
        errorElement.style.display = 'none';
        successElement.style.display = 'block';
      } else {
        confirmPasswordInput.classList.add('error');
        confirmPasswordInput.classList.remove('success');
        errorElement.style.display = 'block';
        successElement.style.display = 'none';
      }
      
      updateSubmitButton();
    }

    // 更新提交按钮状态
    function updateSubmitButton() {
      const currentPassword = document.getElementById('current-password').value;
      const newPassword = document.getElementById('new-password').value;
      const confirmPassword = document.getElementById('confirm-password').value;
      const submitBtn = document.getElementById('submit-password-btn');
      
      const isValid = currentPassword.length > 0 && 
                     newPassword.length >= 6 && 
                     newPassword !== currentPassword &&
                     confirmPassword === newPassword;
      
      submitBtn.disabled = !isValid;
    }

    // 处理密码修改
    function handlePasswordChange(event) {
      event.preventDefault();
      
      const currentPassword = document.getElementById('current-password').value;
      const newPassword = document.getElementById('new-password').value;
      const confirmPassword = document.getElementById('confirm-password').value;
      
      // 验证当前密码
      if (currentPassword !== currentUserPassword) {
        const currentPasswordInput = document.getElementById('current-password');
        currentPasswordInput.classList.add('error');
        document.getElementById('current-password-error').style.display = 'block';
        return;
      } else {
        const currentPasswordInput = document.getElementById('current-password');
        currentPasswordInput.classList.remove('error');
        currentPasswordInput.classList.add('success');
        document.getElementById('current-password-error').style.display = 'none';
      }
      
      // 验证新密码
      if (newPassword.length < 6) {
        alert('New password must be at least 6 characters');
        return;
      }
      
      if (newPassword === currentPassword) {
        alert('New password must be different from current password');
        return;
      }
      
      // 验证确认密码
      if (newPassword !== confirmPassword) {
        alert('Passwords do not match');
        return;
      }
      
      // 模拟密码修改成功
      currentUserPassword = newPassword;
      alert('Password changed successfully! Please sign in again.');
      
      // 重置表单
      document.querySelector('.password-form').reset();
      document.querySelectorAll('.form-input').forEach(input => {
        input.classList.remove('error', 'success');
      });
      document.querySelectorAll('.form-error, .form-success').forEach(element => {
        element.style.display = 'none';
      });
      document.querySelectorAll('.requirement-item').forEach(item => {
        item.classList.remove('valid', 'invalid');
        item.querySelector('.requirement-icon').textContent = '✗';
      });
      document.getElementById('submit-password-btn').disabled = true;
      
      // 跳转到登录页面
      handleLogout();
    }

    // 为当前密码输入框添加实时验证
    function initializePasswordChangeListeners() {
      const currentPasswordInput = document.getElementById('current-password');
      if (currentPasswordInput) {
        currentPasswordInput.addEventListener('input', function() {
          const currentPassword = this.value;
          
          if (currentPassword.length > 0) {
            if (currentPassword === currentUserPassword) {
              this.classList.remove('error');
              this.classList.add('success');
              document.getElementById('current-password-error').style.display = 'none';
            } else {
              this.classList.add('error');
              this.classList.remove('success');
              document.getElementById('current-password-error').style.display = 'block';
            }
          } else {
            this.classList.remove('error', 'success');
            document.getElementById('current-password-error').style.display = 'none';
          }
          
          updateSubmitButton();
          validateNewPassword(); // 重新验证新密码（检查是否与当前密码相同）
        });
      }
    }
  </script>
</body>
</html> 